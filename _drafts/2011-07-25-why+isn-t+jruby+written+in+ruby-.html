---
layout: post
title: Why Isn't JRuby Written in Ruby?
date: '2011-07-25T16:43:00.001-07:00'
author: headius
tags: 
modified_time: '2011-07-25T17:18:01.796-07:00'
blogger_id: tag:blogger.com,1999:blog-4704664917418794835.post-7635366975885469822
---

Recently I've gotten more and more questions about why JRuby isn't implemented in Ruby...or at least why we don't use <b>more</b> Ruby. The answer is rather complicated, so I figured a blog post might be appropriate.<br /><br /><b>Why Implement in Ruby?</b><br /><b><br /></b><br />I think the first question to answer is why it might be a good idea to use Ruby for implementing JRuby in the first place. There's a number of reasons:<br /><br /><ul><li>Ruby is more approachable (than Java) for Rubyists, a primary target market for JRuby.</li><li>Ruby is often cleaner and easier to understand than equivalent code in other languages (like Java).</li><li>Implementing more of JRuby in Ruby would force us to make Ruby run as well as possible.</li></ul><div>These are all true, and I personally would benefit from every one of them. I do love Ruby as a language and try to use it as much as I can...and in fact, more and more of my recent JRuby commits have favored Ruby as the primary implementation language. I expect this trend to continue.</div><div><br /></div><div>Ultimately, though, these reasons don't make a great deal of difference to someone using JRuby as a "black box" Ruby implementation. Unless you need to fix JRuby, you don't ever need to look under the covers. If you simply want to see how a particular Ruby method works, there's versions of most of them in Java (in JRuby), in C (in MRI), in C# (in IronRuby), and in Ruby (in Rubinius). And of course since we all run RubySpec, if you're simply interested in the user-facing behavior of a particular method, you can read through the spec for it and learn more than you might looking at the source in any language.</div><div><br /></div><div>I'd be interested in hearing other reasons people have for implementing in Ruby. The idea of "self-hosting" has been held up as an ideal to strive for, but I feel like it ignores a number of issues we face with an implementation like JRuby. Let's see what those might be...</div><div><br /></div><div><b>Inertia</b></div><div><b><br /></b></div><div>The largest reason for not implementing more of JRuby in Ruby (or for not migrating more of JRuby to Ruby) is a simple one: inertia. The existing core classes are currently implemented in Java, which many Rubyists might see as a negative thing. Implementing more in Ruby would require punching more holes in the Java/Ruby barrier in order to slowly start integrating Ruby-based logic with existing Java-based logic. It would also require JRuby contributors who are familiar with the codebase to do some hunting to find where new code is located, where right now it's easy for them to locate a particular method's implementation.</div><div><br /></div><div>Why not just throw out code for a given part of JRuby en masse, rather than try to jury-rig portions to be in Ruby?</div><div><br /></div><div><b>The "Big Rewrite"</b></div><div><b><br /></b></div><div>As any seasoned software developer knows, throwing out a working codebase to start from scratch is always a bad idea. There's no amount of testing, studying, or specification that will prevent you from losing tweaks and fixes hidden in the code, and no level of commenting will call out all the details you'll miss when you reimplement it.</div><div><br /></div><div>In order for JRuby to suddenly be implemented mostly in Ruby, we'd have to throw out code that's already used in production, already passes the thousands of expectations in RubySpec, and already performs at a very acceptable level. It's code that has been refined, patched, and optimized based on real-world users. Perhaps we'd be able to reuse some code from Rubinius, but even that's a gamble since Rubinius's code has been tweaked and tuned for running on Rubinius's VM.</div><div><br /></div><div>As it stands, the reasons to keep the existing codebase in place vastly outweigh any benefits we'd gain from rewriting large parts of JRuby in Ruby.</div><div><br /></div><div>For what it's worth, if we had actually started the project and could make all those early decisions again, it's likely we'd have used a lot more Ruby than we use right now. Hindsight is 20/20, and hindsight when you inherit an existing project is even sharper.</div><div><br /></div><div>Of course we're just getting started. What about technical reasons for not (re)implementing in Ruby?</div><div><br /></div><div><br /></div>