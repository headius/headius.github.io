---
layout: post
title: Apache + JRuby + Rails + GlassFish = Easy Deployment!
date: '2009-04-25T06:47:00.000-07:00'
author: headius
tags: 
modified_time: '2011-01-25T21:44:30.904-08:00'
blogger_id: tag:blogger.com,1999:blog-4704664917418794835.post-2149889279571544698
blogger_orig_url: http://blog.headius.com/2009/04/apache-jruby-rails-glassfish-easy.html
---

It occurred to me today that a lot of people probably want a JRuby deployment option that works with a front-end web server. I present for you the trivial steps required to host a JRuby server behind Apache.<div><br /></div><div><b><i>Update:</i><span class="Apple-style-span" style="font-weight: normal;"> It's worth mentioning that this works fine with JRuby + Mongrel too, though Mongrel doesn't automatically multithread without <a href="http://mongrel.rubyforge.org/ticket/48">this patch</a> and Rails' production.rb config.threadsafe! line uncommented. The GlassFish gem will automatically multithread with several JRuby instances (in the same server process) by default or a single JRuby instance with config.threadsafe! uncommented.</span></b><br /><div><br /></div><div>Prerequisites:<br /><div><ol><li>Apache with mod_proxy_http enabled (sudo a2enmod proxy_http on Ubuntu)</li><li>Java (sudo apt-get install sun-java6-jdk or the openjdk flavors if you like)</li><li>JRuby (<a href="http://dist.codehaus.org/jruby/1.2.0/jruby-bin-1.2.0.zip">download</a>, unpack, put bin/ in PATH)</li><li>gems appropriate to run your app with JRuby (e.g. rails, activerecord-jdbcsqlite3-adapter, etc)</li><li>production DB all set to go</li></ol><div>Ok. I'm no Apache expert, so I'm sure there's some tweaking necessary for this. Please add your tweaks and suggestions in comments. But basically, all you need to do is run your app using the GlassFish gem and set up Apache to proxy to it. It's that simple.</div><div><ol><li>Install the glassfish gem<br /><pre>gem install glassfish</pre></li><li>From your application directory, run glassfish with these options:<br /><pre>glassfish -p &lt;port&gt; -e production -c &lt;context&gt; -d</pre></li><li>Add ProxyPass and ProxyPassReverse lines to Apache (whereever is appropriate on your system) for the GlassFish server instance. For example, if &lt;port&gt; is 9000 and &lt;context&gt; is foo:<br /><pre>ProxyPass /foo http://localhost:9000/foo<br />ProxyPassReverse /foo http://localhost:9000/foo</pre></li><li>Reload Apache config, however is appropriate for your system</li></ol><div>You'll now be able to access your app via http://servername/foo, and requests will all proxy to the GlassFish server instance.</div><div><br /></div><div>This doesn't do anything to manage the server instance, but since GlassFish can start up as a daemon now, it should be easy to wire into whatever you normally use for that.</div><div><br /></div><div>A few caveats:</div><div><ul><li>I had some trouble getting mod_proxy to allow requests to proxy through. There's probably a right way I'm not doing, so I won't say what I did. If you know the ideal mod_proxy config for this sort of thing, post it in comments</li><li>Although the GlassFish gem is really nice already, we're still working minor kinks out of it and it may still have minor bugs. If you run into something, let us know and we'll get it fixed (and of course, you can use this mod_proxy setup with Mongrel too, if you like).</li><li>I'd love to get some help putting together something that manages servers similar to Phusion Passenger, because that's really the only missing piece here.</li></ul><div>I'll update this post as suggestions come in. Enjoy!</div><div><br /></div><div><b><i>Update:</i><span class="Apple-style-span" style="font-weight: normal;"> Dberg suggests the following improvement:</span></b><br /><blockquote>the one thing you want to remember to do also is to exclude the static assets that normally get served out of rails. To do this simply add some proxypass exclude lines like<br /><br />ProxyPass /images !<br />ProxyPass /javascripts !<br />ProxyPass /stylesheets<br /><br />Then make sure DocumentRoot is set to the right place for these files and you will get a slight performance boost !</blockquote>Thanks for that!</div></div></div></div></div></div>