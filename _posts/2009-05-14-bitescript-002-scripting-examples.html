---
layout: post
title: BiteScript 0.0.2 Scripting Examples
date: '2009-05-14T21:46:00.000-07:00'
author: headius
tags: 
modified_time: '2011-01-25T21:44:30.822-08:00'
blogger_id: tag:blogger.com,1999:blog-4704664917418794835.post-6258193916913863191
blogger_orig_url: http://blog.headius.com/2009/05/bitescript-002-scripting-examples.html
---

I just released BiteScript 0.0.2, which mainly fixes some issues defining packages and non-public classes.<br /><br />BiteScript is basically just a simple DSL for generating JVM bytecode. I use it in <a href="http://kenai.com/projects/duby">Duby</a> and now in <a href="http://kenai.com/projects/ruby2java">the "ruby2java" compiler</a> we'll be using to turn Ruby classes into Java classes.<br /><br />I've <a href="http://blog.headius.com/2009/03/bitescript-001-ruby-dsl-for-jvm.html">blogged about BiteScript here before</a>, but I realized today I never posted any simple "hello world" examples. So here's a few of them, all using the command-line "scripting" mode.<br /><br />First, the simplest version:<br /><pre>main do<br />  ldc "Hello, world!"<br />  aprintln<br />  returnvoid<br />end</pre><br />Obviously this is using a predefined "aprintln" macro, since there's no "aprintln" opcode on the JVM. Here's a longer version that shows how a macro would be defined, and accepts one argument<br /><pre>import java.lang.System<br />import java.io.PrintStream<br /><br />macro :aprintln do<br />  getstatic System, :out, PrintStream<br />  swap<br />  invokevirtual PrintStream, println, [Object]<br />end<br /><br />macro :aprint do<br />  getstatic System, :out, PrintStream<br />  swap<br />  invokevirtual PrintStream, print, [Object]<br />end<br /><br />main do<br />  ldc "Hello, "<br />  aprint<br />  aload 0<br />  aaload 0<br />  aprintln<br />  returnvoid<br />end</pre><br />And of course this is just Ruby code, so you can just use Ruby to alter the generation of code:<br /><pre>main do<br />  5.times do<br />    ldc "Wow!"<br />    aprintln<br />  end<br />  returnvoid<br />end</pre><br />These "BiteScripts" can all be either run with the "bite" command or compiled with the "bitec" command:<br /><pre>$ bite examples/using_ruby.bs <br />Wow!<br />Wow!<br />Wow!<br />Wow!<br />Wow!<br /><br />$ bitec examples/using_ruby.bs <br /><br />$ javap -c examples/using_ruby<br />Compiled from "examples.using_ruby.bs"<br />public class examples.using_ruby extends java.lang.Object{<br />public static void main(java.lang.String[]);<br />  Code:<br />   0: ldc #9; //String Wow!<br />   2: getstatic #15; //Field java/lang/System.out:Ljava/io/PrintStream;<br />   5: swap<br />   6: invokevirtual #21; //Method java/io/PrintStream.println:(Ljava/lang/Object;)V<br />   9: ldc #9; //String Wow!<br />   11: getstatic #15; //Field java/lang/System.out:Ljava/io/PrintStream;<br />   14: swap<br />   15: invokevirtual #21; //Method java/io/PrintStream.println:(Ljava/lang/Object;)V<br />   18: ldc #9; //String Wow!<br />   20: getstatic #15; //Field java/lang/System.out:Ljava/io/PrintStream;<br />   23: swap<br />   24: invokevirtual #21; //Method java/io/PrintStream.println:(Ljava/lang/Object;)V<br />   27: ldc #9; //String Wow!<br />   29: getstatic #15; //Field java/lang/System.out:Ljava/io/PrintStream;<br />   32: swap<br />   33: invokevirtual #21; //Method java/io/PrintStream.println:(Ljava/lang/Object;)V<br />   36: ldc #9; //String Wow!<br />   38: getstatic #15; //Field java/lang/System.out:Ljava/io/PrintStream;<br />   41: swap<br />   42: invokevirtual #21; //Method java/io/PrintStream.println:(Ljava/lang/Object;)V<br />   45: return<br /><br />}</pre><br />This last example shows the resulting JVM bytecode as well.<br /><br />Future plans for BiteScript include making it have better error detection (right now it just falls back on the JVM bytecode verifier, which is not the most descriptive thing in the world) and improving the API to more easily handle all the various combinations of class, field, and method modifiers. I'd also like to make it detect if you're doing bad things to the stack to save you the hassle of interpreting verification errors that may not happen until runtime.<br /><br />Anyway, give it a try and feel free to contribute; the code is all Ruby, wrapping the ASM bytecode library, so anyone that knows Ruby can tweak it. The project page and wiki are hosted at Kenai.com: http://kenai.com/projects/jvmscript<br /><br />And if you're not up on the JVM or JVM bytecodes, the <a href="http://java.sun.com/docs/books/jvms/second_edition/html/VMSpecTOC.doc.html">JVM Specification</a> is an easy-to-read complete reference for code targeting the JVM, and here is <a href="http://homepages.inf.ed.ac.uk/kwxm/JVM/home.html">my favorite JVM opcode quickref</a>.