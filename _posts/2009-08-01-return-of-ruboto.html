---
layout: post
title: Return of Ruboto!
date: '2009-08-01T21:52:00.000-07:00'
author: headius
tags: 
modified_time: '2011-01-25T21:44:30.720-08:00'
blogger_id: tag:blogger.com,1999:blog-4704664917418794835.post-4032684086927576017
blogger_orig_url: http://blog.headius.com/2009/08/return-of-ruboto.html
---

It's been a while since I was able to work on JRuby's Android support, but tonight I managed to finally circle back. And I've got something much more impressive working today: a real IRB application!<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://farm4.static.flickr.com/3568/3780201678_f126a812bb_o_d.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 380px; height: 730px;" src="http://farm4.static.flickr.com/3568/3780201678_f126a812bb_o_d.png" border="0" alt="" /></a><br /><br />(And yes, this works just fine on the phone too)<br /><br />It turned out to be incredibly easy to get this working. I'm not using any stinking plugin because they all seemed to just get in my way. So I generated a dummy application using the "android" tool, dropped the jruby jar in "libs", wrote up a quick interactive console, built and signed it, and that's all there was to it.<br /><br />JRuby turns out to work very well for this sort of thing because we have an interpreter, so we can parse and execute code dynamically. Hooray for interpreted support!<br /><br />I had to tweak a couple things to work around shortcomings in Android:<br /><ul><li>I had to edit the dx tool to allow up to a 1024M heap, since JRuby's jar has a ton of stuff in it</li><li>I had to catch and swallow an ArrayIndexOutOfBounds exception coming out of Dalvik's enum support. Bug!</li></ul>This is of course a proof-of-concept. Writing full applications in Ruby isn't far behind, but we'll need a couple adjustments to JRuby to support it well:<br /><ul><li>Ability to run 100% precompiled with no runtime code generation</li><li>Strip out parser, interpreter, compiler, and bytecode-generation bits to shrink the jar</li><li>Tidy up the AOT compiler and wire it into the app build process</li><li>Generate some Ruby stub logic for the Android APIs, so they'll work well from Ruby</li><li>Strip down the weirder and wilder Ruby features (eval, etc) to allow fastest-possible execution</li></ul>I know how to do all of this.<br /><br />I've pushed <a href="http://github.com/headius/ruboto-irb/tree/master">ruboto-irb</a> to Github so you can check it out and play with it. I welcome contributors :)<br /><br />Ruboto lives!<div><br /></div><div><i><b>Update:</b><span class="Apple-style-span" style="font-style: normal;"> Good news, everyone!</span></i></div><div><br /></div><div><i><span class="Apple-style-span" style="font-style: normal;">First, the two bugs I've encountered have both been previously reported and are due to be fixed in an upcoming Android release. They are the <a href="http://code.google.com/p/android/issues/detail?id=2497">enum bug</a> and the <a href="http://code.google.com/p/android/issues/detail?id=2812">reflection bug</a>.</span></i></div><div><br /></div><div>Second, someone going by the handle of "Psycho" reports in the comments that the next version of the Android Scripting Environment (ASE) will include JRuby support! Of course I'm interested in more than just scripting applications with JRuby...I'd like to be able to write applications using only Ruby code, so I'll continue working on this. But JRuby support seems to be coming in from all directions.</div>