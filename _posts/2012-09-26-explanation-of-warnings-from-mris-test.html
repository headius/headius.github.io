---
layout: post
title: Explanation of Warnings From MRI's Test Suite
date: '2012-09-26T14:03:00.003-07:00'
author: headius
tags: 
modified_time: '2012-09-26T14:06:40.428-07:00'
blogger_id: tag:blogger.com,1999:blog-4704664917418794835.post-5284790001981835990
blogger_orig_url: http://blog.headius.com/2012/09/explanation-of-warnings-from-mris-test.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">JRuby has, for some time now, run the same <a href="https://github.com/jruby/jruby/tree/master/test/externals/ruby1.9">test suite as MRI</a> (C Ruby, Matz's Ruby). Because not all tests pass, we use <a href="https://github.com/seattlerb/minitest-excludes">minitest-excludes</a> to mask out the failures, and over time we unmask stuff as we fix it.<br /><br />However, there's a number of warnings we get from the suite that are nonfatal and unmaskable. I thought I'd show them to you and tell their stories.<br /><br /><b>JRuby 1.9 mode only supports the `psych` YAML engine; ignoring `syck`</b><br /><b><br /></b><div>When we started implementing support for the new "psych" YAML engine that Aaron Patterson created (atop libyaml) for Ruby 1.9, we decided that we would not support the broken "syck" engine anymore. The libyaml version is strictly YAML spec compliant, and this is our contribution to ridding the world of "syck"'s broken YAML forever.<br /><br /><b>GC.stress= does nothing on JRuby</b><br /><b><br /></b></div><div>JRuby does not have direct control over the JVM's GC, and so we can't implement things like GC.stress=, which MRI uses to put the GC into "stress" mode (GCing much more frequently to better test GC stability and behavior). There are flags for the JVM to do this sort of testing, but since we don't really need to test the JVM's GC for correctness and stability, we have not exposed those flags directly.</div><div><br /></div><div>This flag is used in a number of MRI tests to force GC to happen more often and/or to actually test GC behaviors.<br /><br /><b>SAFE levels are not supported in JRuby</b><br /><b><br /></b></div><div>JRuby does not support standard Ruby's security model, "safe levels", because we believe safe levels are a flawed, too-coarse mechanism. On JRuby, you can use standard Java security policies.</div><div><br /></div><div>We have debated mapping the various Ruby safe levels to equivalent sets of Java security permissions, but have never gotten around to it.<br /><br /><b>GC.enable does nothing on JRuby / GC.disable does nothing on JRuby</b><br /><b><br /></b></div><div>There's no standard API on the JVM to disable the garbage collector completely, so GC.enable and GC.disable do nothing in JRuby.</div><div><br /></div><div>It's also interesting to note that while you <b>can</b>&nbsp;request a GC run from the JVM by calling System.gc, JRuby also stubs out Ruby's GC.start. We opted to do this because GC.start is used in some Ruby libraries as a band-aid around Ruby's sometimes-slow GC, but the same call on JRuby is both unnecessary (because GC overhead is rarely a problem) and a major performance hit (because it triggers a full GC over the entire heap).</div><div><br /></div></div>