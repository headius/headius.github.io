---
layout: post
title: And They Said JRuby was Dead...
date: '2006-05-12T15:05:00.000-07:00'
author: headius
tags: 
modified_time: '2011-01-25T21:44:34.674-08:00'
blogger_id: tag:blogger.com,1999:blog-4704664917418794835.post-1259836729152008436
blogger_orig_url: http://blog.headius.com/2006/05/and-they-said-jruby-was-dead.html
---

Things are looking very good for <a href="https://www28.cplan.com/javaone06_cv_124_1/session_details.jsp?isid=278059&ilocation_id=124-1&ilanguage=english">JavaOne</a>.<br /><br />The past several months have been a period of furious development on the JRuby project, with milestone after milestone flying by. Four months ago we couldn't run most basic Ruby apps and were still wrestling with basic 1.8 compatibility issues. Since that time we've gotten IRB working, Rake running, RubyGems almost working, and then managed to process a simple Rails request. All the while, our existing libraries have grown in stability and completeness, and we've attracted many new contributors to the project. This stone is gathering no moss.<br /><br />JavaOne is a going to be a big event for us, but we wanted something more. What would the week before a major conference be without some buzz-worthy announcements to make?<br /><br />Hold on to your hats.<br /><br /><span style="font-weight:bold;">Where We've Been</span><br /><br />JRuby has been around for around five years. It was originally based on Ruby 1.6 C code, and was pretty much a direct port from C to Java. Over those years, up until Fall of 2005, the focus was mainly on basic compability issues, updating libraries and language semantics to 1.8 levels, and generally just making things work well enough for use. All told, it was a pretty good port, but there was a long way to go. There were a few Java apps that used it for scripting, but the tide was turning away from JRuby with the release of ever-more-complex Ruby applications that were increasingly difficult to run on a partial implementation.<br /><br />Starting this past Fall, and really gaining steam since the start of 2006, our focus shifted from simple 1.8 compatibilities and interpreter tweaks to much more ambitious goals. We began to tackle the killer apps for Ruby one by one, fixing what broke and getting a much more intimate knowledge of both Ruby and JRuby internals than we had before. First came early runs of Rake. They worked, but required changes to the way external scripts launched. Then something a bit more lofty: I disappeared into my office for a week to get IRB working...and work it eventually did. Then we realized that RubyGems would be a great target; while it's not yet working 100%, it's now really close.<br /><br />Then came Rails.<br /><br /><span style="font-weight:bold;">The Big Ticket</span><br /><br />There is little doubt that Rails is the app that's selling Ruby today. Ruby has become, in many circles, synonymous with Ruby on Rails. While there's a discussion to be had about whether a single killer app should hold so much sway, it's impossible to argue that Ruby would be where it is today without Rails dragging it into the spotlight. Rails has, more than any other app, brought Ruby to the world.<br /><br />We just had to get a bite of that apple.<br /><br />Getting Rails to run in JRuby is a very challenging task. For those of you that know what Rails does, imagine the code that's required to do that. Think of all the magic necessary to get things  so slick and transparent. Look at the size of the Rails codebase which, while far smaller than a beastly Java library, is positively enormous compared to the typical Ruby app. If you've ever seen the code, you know what kinds of tricks and traps there are in the Rails code, and how many dark alleys you might venture down when debugging a problem deep within its guts.<br /><br />Now imagine running it on an interpreter that breaks in weird and indeterminate ways.<br /><br />We have fixed hundreds of issues on the road to getting Rails working. Every step of the way, we have had to pore through the Rails code, digging for that one irreducible test case that demonstrates a bug, sometimes sifting through tens of files, thousands of lines of code. It has been an extreme challenge. However...<br /><br /><span style="font-weight:bold;">What Would You Do With JRuby on Rails?</span><br /><br />Today, we can announce that a simple end-to-end Rails application has successfully run under JRuby.<br /><br />As reported on <a href="http://www.bloglines.com/blog/ThomasEEnebo?id=16">Tom's blog</a>, a little CRUDified cookbook application can now deliver a form and process submissions correctly. Using an ActiveRecord-to-JDBC adapter (yes, you read that right) donated by <a href="http://blog.nicksieger.com/">Nick Sieger</a>, the app is able to generate a form, display a table of results, and process creates and deletes. All this magic, all working on JRuby. We're ecstatic.<br /><br /><span style="font-weight:bold;">Can It Truly Be?</span><br /><br />See for yourself. It's even wrapped in a little servlet that invokes Rails FastCGI-style, keeping it loaded in memory for additional requests. It's the culmination of all our experiments, bug fixes, and hard work over the past several months. And it sure feels good.<br /><br /><img src="http://www.tc.umn.edu/%7Eenebo/images/rails_working.jpg" border=0><br /><br /><span style="font-weight:bold;">Onward and Upward</span><br /><br />Of course this demo is slightly canned. We coded to the test, and the average Rails app still isn't going to work out of the box. There's plenty of little things missing, like reliable session management, more ActiveRecord magic, and various rendering flaws, to list a few we know about. But as a technology preview, running Rails essentially unmodified--even on a simple end-to-end app--is our biggest milestone yet.<br /><br />With the recent successes, we plan to target the end of summer for full, general-purpose Rails support. With more contributors and more time to work, that timetable could move up, but there's also the compiler work that has begun in earnest. It's going to be a great summer for coding, and a great year for dynamic(-typed) lanaguages on the JVM.<br /><br />Oh, and one last note for the perennial skeptics and naysayers out there: <span style="font-weight:bold;">Rails on the JVM is coming sooner than you think.</span><br /><br /><span style="font-weight:bold;">A Few Other Updates</span><br /><br />Here's another couple items to hold you off until the next round of milestones:<br /><br /><span style="font-weight:bold;">IRB glitches resolved</span><br />A remaining IRB bug that caused declared classes to be scoped under Kernel (as in class A would be scoped as Kernel::A) has been resolved. I had to get this fixed to demo IRB at JavaOne<br /><br /><span style="font-weight:bold;">RubyGems works, sorta</span><br />Tom discovered that if a known good RubyGems install (from a C Ruby installation, for example) was copied into JRuby's dirs, gems would require and load correctly. So although our RubyGems and gem install code isn't quite there yet, actually using gems seems to be working. Huzzah!<br /><br /><span style="font-weight:bold;">Improved codegen DSL</span><br /><a href="http://www.iunknown.com">John Lam</a>, of the RubyCLR project, pointed me to a nice little eval trick that has helped simplify my <a href="http://headius.blogspot.com/2006/05/dsl-for-bytecode-generation.html">code-generation DSL</a> a bit. By eliminating most of the block params, it's a bit less verbose and certainly prettier:<br /><pre>class_bytes = ClassBuilder.def_class :public, "FooClass" do<br />  def_constructor :public do<br />    call_super<br />    return_void<br />  end<br /><br />  def_method :public, :string, "myMethod", [:void], [:exception] do<br />    call_this GenUtils.array_cls(:string), "getStringArr"<br />    call_this :string, "getMessage"<br />    return_top :ref<br />  end<br />  <br />  def_method :private, :string, "getMessage", [:void] do<br />    construct_obj :stringbuffer, [:string] do<br />      constant "Now I will say: "<br />    end<br />    <br />    call_method :stringbuffer, "append", :string, :stringbuffer do<br />      constant "Hello CodeGen!"<br />    end<br />    call_method :string, "toString", :void, :stringbuffer<br />    return_top :ref<br />  end<br />  <br />  def_method :public, GenUtils.array_cls(:string), "getStringArr" do<br />    construct_array :string, 5 do |i|<br />      constant "string \##{i}"<br />    end<br />    <br />    array_set 2, :string do<br />      constant "replacement at index 2"<br />    end<br />    <br />    return_top :ref<br />  end<br />end</pre>I'll be going full-speed-ahead on compilation after JavaOne, you can count on that.<br /><br /><span style="font-weight:bold;">YAML parser improved?</span><br />One of our favorite contributors, Ola Bini, now has a working version of a YAML 1.1-compliant parser which is able to load fairly large files. There's still some work to do, but if all goes well we may be able to migrate to it in the near term.<br /><br /><span style="font-weight:bold;">Dynamic languages press conference</span><br />The JRuby team (Tom and I) will be part of a JavaOne Day-1 press conference on the future of dynamic languages on the JVM. Along with the <a href="http://wiki.caucho.com/Quercus">Quercus</a> guys from Caucho (PHP for the JVM) and <a href="https://scripting.dev.java.net/">Roberto Chinnici</a> from Sun (doing cool stuff with <a href="http://www.jcp.org/aboutJava/communityprocess/edr/jsr223/">JSR223</a>), we'll have our own ten minutes to show the press how cool JRuby really is. It oughta be a fun time, and should help get JRuby a bit wider exposure.<br /><br />This is just too much fun.