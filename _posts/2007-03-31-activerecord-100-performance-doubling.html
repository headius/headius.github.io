---
layout: post
title: ActiveRecord 100%, Performance Doubling, Java Support Improving
date: '2007-03-31T12:00:00.000-07:00'
author: headius
tags: 
modified_time: '2011-01-25T21:44:33.024-08:00'
blogger_id: tag:blogger.com,1999:blog-4704664917418794835.post-1720521194768263407
blogger_orig_url: http://blog.headius.com/2007/03/activerecord-100-performance-doubling.html
---

I haven't blogged a solid JRuby update recently...and this one isn't going to be as solid as I'd like, but it should let you all know that the wheels are still moving and the train is picking up speed. It's astounding how much progress is being made.<br /><br /><b>ActiveRecord Now Fully Supported</b><br /><br />It's good to have such incredible community members and great core team members.<br /><br /><a href="http://ola-bini.blogspot.com/">Ola Bini</a>, who recently accepted an offer from ThoughtWorks, has been hitting Rails unit tests hard. And the module with the most failures has always been ActiveRecord. It's the most complicated and the weakest point in the JRuby on Rails story.<br /><br />Until now.<br /><pre>1031 tests, 3839 assertions, 0 failures, 0 errors</pre>That headline should read "ActiveRecord Fully Supported on JRuby", for you press affiliates out there.<br /><br />Of course there's a few caveats, but they're pretty minor in this case. That's zero failures and zero errors when running against MySQL, but it's certainly a de-facto standard in the Rails world. The next step is to get as many other databases to 0/0 as possible. And those are much smaller steps than this first one.<br /><br />So what does this mean for JRuby on Rails users? Well in general, it means that the heart of your DB-driven JRoR apps--ActiveRecord--is now the best-supported piece of the puzzle. It also means that overall Rails support is well into the 99% range and still climbing.<br /><br /><b>Performance Continuing to Improve</b><br /><br />In addition to the focus on getting Rails working well (which is really a focus on improving overall Ruby compatibility) we've been hitting performance much harder the past couple weeks. I especially have been splitting my time between interpreter and compiler work. As a result of all our efforts, the current trunk code is almost another 2X the performance of 0.9.8, released less than a month ago. The compiler also supports almost 2X the number of syntactic constructs it did in 0.9.8, and it's getting faster and more stable every day.<br /><br />There are actually a number of benchmarks running faster than MRI (the C version of Ruby) even when interpreted, showing that we're finally making good on our promise to have interpreted JRuby run as fast as MRI. So it truly does seem that the compiler will be "bonus" performance once we work out the remaining bottlenecks in the system.<br /><br /><b>Java Support Looking and Feeling Better</b><br /><br />There have been two areas of focus for Java support the past few months: rounding out features and syntax and improving performance. Both had some great jumps in JRuby 0.9.8, with a couple small fixes improving performance many times and with concrete/abstract class extension finally making it into a release.<br /><br />Since 0.9.8 we've continued to make progress on both fronts. I've made a few additional small changes to improve overall performance, and Ola's been moving some especially critical pieces of code into Java, since they represented a lot of back-and-forth across that barrier. Where calling into Java code was previously as bad as twenty times slower than calling Ruby code, it's now a modest two times slower. We expect to improve that further, getting as close to Ruby invocation speed as possible.<br /><br />We've also just added what should hopefully be the final revision to our various "import" syntaxes. Oddly enough, we've come full circle to "import":<br /></p><pre># create a new constant "System" pointing at it<br />import java.lang.System<br /><br /># use Java::syntax for less-common packages<br />import Java::my.weird.package.MyClass</pre>And we're considering some improvements to how multiple classes are imported and how to specify an alternate constant name (for classes like String, which would be a bad idea to overwrite).<br /><br />You can expect to see this all solidifying as we run these last miles toward JRuby 1.0.<br /><br />--<br /><br />I will blog more on all this as we get into April, but it's truly shaping up to be Springtime for JRuby in JavaLand.