---
layout: post
title: Compilers, Conferences, Codehaus...Oh My!
date: '2006-07-14T07:41:00.000-07:00'
author: headius
tags: 
modified_time: '2011-01-25T21:44:34.489-08:00'
blogger_id: tag:blogger.com,1999:blog-4704664917418794835.post-6959153395979740149
blogger_orig_url: http://blog.headius.com/2006/07/compilers-conferences-codehausoh-my.html
---

I keep wondering if things can continue moving along so well indefinitely. JRuby's got the momentum of a steamroller shot out of a cannon these days.<br /><br /><span style="font-weight: bold;">Compilers</span><br /><br />I have been back at work on the compiler, which is starting to take real shape now. I'm doing this initial straight-forward version in Java, so I can work on evolving my code-generation library independently. This version also isn't quite so complicated that it warrants using Ruby.<br /><br />Early returns have been very good. I've been testing it so far with the standard "bi-recursive" fib algorithm, with a few other node types thrown in as I implement them:<br /><br /><pre>def fib_java(n)<br /> 1.0<br /> false<br /> true<br /> [1, 2, 3, 4, 5]<br /> "hello"<br /> if n &lt; 2<br />   n<br /> else<br />   fib_java(n - 2) + fib_java(n - 1)<br /> end<br />end</pre><br />The performance boost from the early compiler is roughly 50% when running fib(20):<br /><br /><pre>fib(20)<br />Time for interpreted: 1.524<br />Time for compiled: 0.729</pre><br />The fib algorithm is obviously extremely call-heavy. There's two recursions to fib plus four other calls for '&lt;', '-', and '+'. In JRuby, this means that the overhead of making dyn-dispatched method calls is almost as high as directly interpreting code. For larger runs of fib performance tails off a bit because of this overhead. We're taking a two-pronged approach to performance right now; the compiler is obviously one prong but overall runtime optimization is the other. The compiler gives us an easy 50% boost, but we may see another large boost just by cleaning up and redesigining the runtime to optimize call paths. I would not be surprised if we're able to exceed C Ruby's performance in the near term.<br /><br />Oh, and I love the following stack trace from a bug in the compiler. Note the file and line number where the error occurred:<br /><br /><pre><span style="font-size:90%;">Exception in thread "main" java.lang.IncompatibleClassChangeError<br />       at MyCompiledScript.fib_java (samples/test_fib_compiler.rb:2)<br />       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br />       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)</span></pre><br />How cool is that?<br /><br /><span style="font-weight: bold;">Conferences</span><br /><br />Close on the heels of my <a href="http://headius.blogspot.com/2006/07/jruby-not-to-appear-at-rubyconf-2006.html">disappointing mixup</a> with <a href="http://www.rubyconf.com">RubyConf 2006</a>, we have received an invitation to present at <a href="http://www.javapolis.com">JavaPolis 2006</a> in Antwerp, Belgium. We actually were hoping to go and would have planned on delivering a BOF or Quicky session, but after sending a proposal one of the conference organizers said JRuby was already on the wish list. We're guaranteed "at least" a full session. JavaPolis will be held December 13-15, and we'll be getting cozy with some of the top Java folks in the world. It should be a fun and exciting event, especially considering what we'll get done in the five months before then.<br /><br />I've also received other offers from potential RubyConf 2006 presenters to share their tiem slots with me. We should be able to get word out and demos presented after all. I'd still like to be able to present without stepping on others' time, so if you really would like to see JRuby have a full presentation at RubyConf this year, <a href="mailto:contact@rubycentral.org">email the organizers</a>.<br /><br /><span style="font-weight: bold;">Codehaus</span><br /><br />We have made the move to <a href="http://jruby.codehaus.org">Codehaus</a>, and we've mostly got JRuby operations migrated there from SourceForge. <a href="http://jira.codehaus.org/browse/JRUBY">JIRA</a> is up, Confluence is up with a minimal set of pages, and we're totally running off Codehaus <a href="http://svn.codehaus.org/jruby">SVN</a> now. So far we're very happy with the move; JIRA is beautiful and the SVN repo works great. We have not yet migrated off SF.net email lists and we haven't moved over all bugs from SF's tracker, but otherwise we're basically a Codehaus project now. Huzzah!